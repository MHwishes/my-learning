## 浏览器的基本理解

简单来说浏览器可以分为两部分，

- shell: shell 的种类 相对比较多，内核则比较少。shell 是指浏览器的外壳:例如菜单，工具栏等。主要是提供 给用户界面操作，参数设置等等。它是调用内核来实现各种功能的。
- 内核：内核才是浏览器的核心。 内核是基于标记语言显示内容的程序或模块。也有一些浏览器并不区分外壳和内核。

也有一些浏览器并不区分外壳和内核。从 Mozilla 将 Gecko 独立出来后，才有了外壳和内核的明确划分。

## 浏览器内核的理解

主要分成两部分:

- 渲染引擎: 渲染引擎的职责就是渲染，即在浏览器窗口中显示所请求的内容。默认情况下，渲染引 擎可以显示 html、xml 文档及图片，它也可以借助插件(一种浏览器扩展)显示其他类型 数据，例如使用 PDF 阅读器插件，可以显示 PDF 格式。
- JS 引擎:解析和执行 javascript 来实现网页的动态效果。最开始渲染引擎和 JS 引擎并 没有区分的很明确，后来 JS 引擎越来越独立，内核就倾向于只指渲染引擎。

## 浏览器架构

+ 用户界面

  + 主进程

  + 内核

    + 渲染引擎
    + js 引擎
      + 执行栈

    + 事件触发线程
      + 消息队列
        + 微任务
        + 宏任务
    + 网络异步线程
    + 定时器线程

## 渲染过程中遇到 JS 文件怎么处理?(浏览器解析过程)

JavaScript 的加载、解析与执行会阻塞文档的解析，也就是说，在构建 DOM 时，HTML 解析器若遇到了 JavaScript，那么它会暂停文档的解析，将控制权移交给 JavaScript 引擎， 等 JavaScript 引擎运行完毕，浏览器再从中断的地方恢复继续解析文档。

也就是说，如果你想首屏渲染的越快，就越不应该在首屏就加载 JS 文件，这也是都 建议将 script 标签放在 body 标签底部的原因。当然在当下，并不是说 script 标签必须放 在底部，因为你可以给 script 标签添加 defer 或者 async 属性。



###  浏览器的内核多线程

浏览器的内核是多线程的，它们在内核控制下相互配合以保持同步，一个浏览器至少实现三个常驻线程：`JavaScript引擎线程`，`GUI渲染线程`，`浏览器事件触发线程`。

+ `JavaScript引擎`是基于事件驱动单线程执行的，JavaScript引擎一直等待着任务队列中任务的到来，然后加以处理，浏览器无论什么时候都只有一个JavaScript线程在运行JavaScript程序。

  JS引擎主要有两个组件构成：

  - 堆-内存分配发生的地方
  - 栈-函数调用时会形一个个栈帧（frame）

+ `GUI渲染线程`负责渲染浏览器界面，当界面需要重绘（Repaint）或由于某种操作引发回流(Reflow)时，该线程就会执行。但需要注意，GUI渲染线程与`JavaScript引擎`是互斥的，当`JavaScript引擎`执行时GUI线程会被挂起，GUI更新会被保存在一个队列中等到JavaScript引擎空闲时立即被执行。

+ `事件触发线程`，当一个事件被触发时，该线程会把事件添加到待处理队列的队尾，等待JavaScript引擎的处理。这些事件可来自JavaScript引擎当前执行的代码块如setTimeout、也可来自浏览器内核的其他线程如鼠标点击、Ajax异步请求等，但由于JavaScript的单线程关系，所有这些事件都得排队等待JavaScript引擎处理（当线程中没有执行任何同步代码的前提下才会执行异步代码）。